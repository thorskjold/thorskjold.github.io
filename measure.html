<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
    <meta name="apple-mobile-web-app-title" content="Orientation">
    <link rel="apple-touch-icon-precomposed" href="https://thorskjold.com/resources/images/measure.png"/>
    <style>

        body {
            background: rgb(245, 245, 245);
            font-family: -apple-system, Helvetica;
            font-size: 16px;
            display: flex;
            flex-direction: column;
            margin: 0;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        #title {
            width: -moz-calc(100% - 40px);
            width: -webkit-calc(100% - 40px);
            width: calc(100% - 40px);
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            padding-top: 50px;
            margin-bottom: -15px;
            margin-left: 20px;
            font-size: 34px;
            font-weight: bold;
        }

        #recalibrate {
            margin-bottom: -12px;
            color: #fdca30;
            font-size: 16px;
            display: none;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        #recalibrate:active {
            color: #c59402;
        }

        .description {
            height: 14px;
            width: -moz-calc(100% - 40px);
            width: -webkit-calc(100% - 40px);
            width: calc(100% - 40px);
            padding-top: 40px;
            margin-bottom: -15px;
            margin-left: 20px;
            font-size: 14px;
            color: rgb(155, 155, 155);
        }

        .footer {
            height: 14px;
            width: -moz-calc(100% - 40px);
            width: -webkit-calc(100% - 40px);
            width: calc(100% - 40px);
            padding-top: 15px;
            padding-bottom: 10px;
            margin-left: 20px;
            font-size: 14px;
            color: rgb(155, 155, 155);
        }

        .label {
            color: rgb(155, 155, 155);
        }

        .horizontal {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 50px;
            min-height: 50px;
            background: white;
            border-bottom: 1px solid rgb(220, 220, 220);
        }

        .header {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        .vertical {
            height: 150px;
            width: 100%;
            display: flex;
            align-items: flex-start;
            flex-direction: column;
            justify-content: space-between;
        }

        .hidden {
            display: none;
        }
        
        .bufferTop {
            margin-top: 30px;
            border-top: 1px solid rgb(220, 220, 220);
        }

        .bufferBottom {
            margin-bottom: 30px;
            border-bottom: 1px solid rgb(220, 220, 220);
        }

        .image {
            height: 100%;
        }

        #stepper {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .content {
            width: -moz-calc(100% - 40px);
            width: -webkit-calc(100% - 40px);
            width: calc(100% - 40px);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .quarter {
            text-align: start;
            height: 100%;
            width: -moz-calc((100% - 40px) / 4);
            width: -webkit-calc((100% - 40px) / 4);
            width: calc((100% - 40px) / 4);
        }

        #request {
            color: #147EFB;
        }

        #request:active, .step:active {
            color: #034fa6;
        }

        #reset {
            text-align: end;
            color: #fd3d30;
            font-size: 16px;
            display: none;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        #reset:active {
            color: #c50f02;
        }

        .step {
            text-align: end;
            color: #147EFB;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        #click {
            width: 16px;
            height: 16px;
        }

        #illustration {
            margin: 0 auto;
            display: none;
            height: 100%;
            width: min(400px, 100%);
            margin-top: 30px;
            margin-bottom: 30px;
        }

        /* The switch - the box around the slider */
        .switch {
            position: relative;
            width: 52px;
            height: 32px;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        /* Hide default HTML checkbox */
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* The slider */
        .slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #16c946;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(20px);
            -ms-transform: translateX(20px);
            transform: translateX(20px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* dark mode styling */
        @media (prefers-color-scheme: dark) {

            body {
                background: black;
                color: white;
            }

            .description, .footer, .label {
                color: rgb(100, 100, 100);
            }

            .horizontal {
                background: rgb(20, 20, 20);
                border-bottom: 1px solid rgb(35, 35, 35);
            }

            .bufferTop {
                border-top: 1px solid rgb(35, 35, 35);
            }

            .bufferBottom {
                border-bottom: 1px solid rgb(35, 35, 35);
            }

            .slider {
                background-color: #323232;
            }

            #negative {
                fill: #141414;
            }

        }

    </style>
</head>

<body id="body">
    
    <div id="title">
        Orientation
        <div id="recalibrate" class="hidden" onclick="recalibrate()">Recalibrate</div>
    </div>
    <div id="request" class="horizontal bufferTop" onclick="request()">
        <div class="content">
            Request sensor permission
            <svg draggable="false" id="click" width="500px" height="500px" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
                <path id="chevron" d="M499.143 250.945 C499.143 254.593 498.471 258.002 497.127 261.17 495.783 264.338 493.766 267.266 491.078 269.955 L262.68 493.169 C257.496 498.353 251.255 500.945 243.959 500.945 238.966 500.945 234.502 499.793 230.566 497.489 226.63 495.185 223.461 492.065 221.061 488.128 218.661 484.192 217.461 479.728 217.461 474.736 217.461 467.631 220.053 461.391 225.237 456.014 L434.915 250.945 225.237 45.876 C220.053 40.5 217.461 34.26 217.461 27.155 217.461 22.163 218.661 17.699 221.061 13.762 223.461 9.826 226.63 6.706 230.566 4.402 234.502 2.097 238.966 0.945 243.959 0.945 251.255 0.945 257.496 3.442 262.68 8.434 L491.078 231.936 C493.766 234.624 495.783 237.552 497.127 240.721 498.471 243.889 499.143 247.297 499.143 250.945 Z" fill="#147efb" fill-opacity="1" stroke="none"/>
            </svg>
        </div>
    </div>
    <div class="horizontal hidden bufferTop">
        <div class="content">
            Alpha
            <div id="alpha"></div>
        </div>
    </div>
    <div class="horizontal hidden">
        <div class="content">
            Beta
            <div id="beta"></div>
        </div>
    </div>
    <div class="horizontal hidden">
        <div class="content">
            Gamma
            <div id="gamma"></div>
        </div>
    </div>
    <div class="footer hidden">Alpha 0 to 360. Beta & gamma -180 to 180.</div>

    <div class="horizontal hidden bufferTop">
        <div class="content">
            Round
            <label id="switch" class="switch"><input type="checkbox" id="rounded" checked onclick="precision()"><span class="slider round"></span></label>
        </div>
    </div>
    <div class="horizontal hidden">
        <div class="content">
            Threshold
            <label id="switch" class="switch"><input type="checkbox" id="threshold" checked onclick="threshold()"><span class="slider round"></span></label>
        </div>
    </div>
    <div class="horizontal hidden">
        <div class="content">
            Noise reduction
            <label id="switch" class="switch"><input type="checkbox" id="noise" checked onclick="reduce()"><span class="slider round"></span></label>
        </div>
    </div>
    <div class="footer hidden">Threshold 2Â° difference. Noise 300 ms.</div>

    <div class="description hidden header">
        STEP COUNTER
        <div id="reset" onclick="reset()">Reset</div>
    </div>
    <div class="horizontal hidden bufferTop">
        <div class="content">
            <div class="quarter label">Alpha</div>
            <div class="quarter label">Beta</div>
            <div class="quarter label">Gamma</div>
            <div class="quarter step" onclick="step()">Add</div>
        </div>
    </div>
    <div id="stepper"></div>

    <div class="description hidden">INFOGRAPHICS</div>
    <div class="horizontal hidden bufferTop bufferBottom image">
        <div class="content">
            <img draggable="false" id="illustration" src="https://thorskjold.com/resources/images/illustration.png">
        </div>
    </div>

</body>

<script>

    // illustration preloading
    window.addEventListener('load', function () {
        document.getElementById("illustration").style.display = "block";
    });

    // initialization
    document.addEventListener("touchstart", function(){}, true);
    window.count = 0;
    window.round = true;
    window.slow = true;
    window.noise = true;
    window.A = 0;
    window.B = 0;
    window.G = 0;

    // reload scrolling
    window.onbeforeunload = function () {
        window.scrollTo(0, 0);
    };

    // count reset and stepper

    function reset() {

        document.getElementById("reset").style.display = "none";
        document.getElementById("stepper").innerHTML = "";
        window.count = 0;

    };

    function step() {
        
        if (window.A != null && window.B != null && window.G != null) {

            document.getElementById("reset").style.display = "block";

            window.count += 1;
            
            stepper = document.getElementById("stepper");

            // parent
            horizontal = document.createElement('div');
            horizontal.classList.add("horizontal");

            // first child
            content = document.createElement('div');
            content.classList.add("content");

            // second children
            count1 = document.createElement('div');
            count1.classList.add("quarter");
            count1.innerHTML = parseInt(window.A);
            content.append(count1);

            count2 = document.createElement('div');
            count2.classList.add("quarter");
            count2.innerHTML = parseInt(window.B);
            content.append(count2);

            count3 = document.createElement('div');
            count3.classList.add("quarter");
            count3.innerHTML = parseInt(window.G);
            content.append(count3);

            count4 = document.createElement('div');
            count4.classList.add("quarter");
            count4.style.textAlign = "end";
            count4.innerHTML = "#" + window.count;
            content.append(count4);

            // write to DOM
            horizontal.append(content);
            stepper.prepend(horizontal);

        };
    };

    // modifiers

    function threshold() {

        if (document.getElementById("threshold").checked) {
            window.slow = true;
        } else {
            window.slow = false;
        };

    };

    function precision() {

        if (document.getElementById("rounded").checked) {
            window.round = true;
        } else {
            window.round = false;
        };
        
    };

    function reduce() {

        if (document.getElementById("noise").checked) {
            window.noise = true;
        } else {
            window.noise = false;
        };

    };

    // show content when permission granted

    function granted() {
        var elements = document.getElementsByClassName('hidden');
        for (var i = 0; i < elements.length; i++) {
            elements[i].style.display = "flex";
        };
        document.getElementById("request").style.display = "none";
    };

    // recalibrate device orientation

    function recalibrate() {
        assign();
    };

    // event listeners for alpha, beta, gamma

    function assign() {

        var lastExecution;
        window.addEventListener("deviceorientation", function (event) {

            if (window.noise) {
                // delay updates 300ms to avoid flickering numbers
                var now = Date.now();
                if (now - lastExecution < 300) return;
                lastExecution = now;
            };

            // thresholding measurements
            if (window.slow) {

            if (window.A != null && Math.abs(window.A - event.alpha) > 2) {
                var A = event.alpha;
            } else {
                var A = window.A;
            };

            if (window.B != null && Math.abs(window.B - event.beta) > 2) {
                var B = event.beta;
            } else {
                var B = window.B;
            };

            if (window.G != null && Math.abs(window.G - event.gamma) > 2) {
                var G = event.gamma;
            } else {
                var G = window.G;
            };

            } else {
            var A = event.alpha;
            var B = event.beta;
            var G = event.gamma;
            };

            // rounding numbers
            if (window.round) {
            document.getElementById("alpha").innerHTML = parseInt(A);
            document.getElementById("beta").innerHTML = parseInt(B);
            document.getElementById("gamma").innerHTML = parseInt(G);
            } else {
            document.getElementById("alpha").innerHTML = A;
            document.getElementById("beta").innerHTML = B;
            document.getElementById("gamma").innerHTML = G;
            };

            window.A = A;
            window.B = B;
            window.G = G;

        });

    };

    // sensor permission request

    function request() {


        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
                .then(permissionState => {
                    if (permissionState === 'granted') {
                        assign();
                        granted();
                    };
                })
                .catch(console.error);
        } else {
            assign();
            granted();
        };

    };

</script>

</html>