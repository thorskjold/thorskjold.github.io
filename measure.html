<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
    <meta name="apple-mobile-web-app-title" content="Orientation">
    <link rel="apple-touch-icon-precomposed" href="https://thorskjold.com/resources/images/measure.png"/>
    <style>

        body {
            background: rgb(245, 245, 245);
            font-family: -apple-system, Helvetica;
            display: flex;
            flex-direction: column;
            margin: 0;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        #title {
            padding-top: 50px;
            margin-bottom: -15px;
            margin-left: 20px;
            font-size: 34px;
            font-weight: bold;
        }

        .description {
            padding-top: 40px;
            margin-bottom: -15px;
            margin-left: 20px;
            font-size: 14px;
            color: rgb(155, 155, 155);
        }

        .horizontal {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 50px;
            min-height: 50px;
            background: white;
            border-bottom: 1px solid rgb(220, 220, 220);
        }

        .vertical {
            height: 60px;
            width: 100%;
            display: flex;
            align-items: flex-start;
            flex-direction: column;
            justify-content: space-between;
        }

        .range {
            display: flex;
            flex-direction: row;
        }

        .param {
            width: 80px;
        }

        .recorder {
            height: 100px;
            min-height: 100px;
        }

        #record {
            width: 80px;
            height: 80px;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        #negative {
            fill: #ffffff;
        }

        .hidden {
            display: none;
        }
        
        .bufferTop {
            margin-top: 30px;
            border-top: 1px solid rgb(220, 220, 220);
        }

        .bufferBottom {
            margin-bottom: 30px;
            border-bottom: 1px solid rgb(220, 220, 220);
        }

        .image {
            height: 100%;
        }

        .content {
            width: -moz-calc(100% - 40px);
            width: -webkit-calc(100% - 40px);
            width: calc(100% - 40px);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        #click {
            width: 16px;
            height: 16px;
        }

        #illustration {
            margin: 0 auto;
            display: none;
            height: 100%;
            width: min(400px, 100%);
            margin-top: 30px;
            margin-bottom: 30px;
        }

        /* animation */
        .moveIn {
            animation-name: moveIn;
            animation-duration: 0.4s;
        }

        @keyframes moveIn {
            0% {
                transform: translate(100%, -82px);
                opacity: 0;
            }
            100% {
                transform: translate(0, -82px);
                opacity: 1;
            }
        }

        .moveOut {
            animation-name: moveOut;
            animation-duration: 0.4s;
        }
        
        @keyframes moveOut {
            0% {
                transform: translate(0, 0);
                opacity: 1;
            }
            100% {
                transform: translate(-100%, 0);
                opacity: 0;
            }
        }

        /* The switch - the box around the slider */
        .switch {
            position: relative;
            width: 52px;
            height: 32px;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
        }

        /* Hide default HTML checkbox */
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* The slider */
        .slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #16c946;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(20px);
            -ms-transform: translateX(20px);
            transform: translateX(20px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* dark mode styling */
        @media (prefers-color-scheme: dark) {

            body {
                background: black;
                color: white;
            }

            .description {
                color: rgb(100, 100, 100);
            }

            .horizontal {
                background: rgb(20, 20, 20);
                border-bottom: 1px solid rgb(35, 35, 35);
            }

            .bufferTop {
                border-top: 1px solid rgb(35, 35, 35);
            }

            .bufferBottom {
                border-bottom: 1px solid rgb(35, 35, 35);
            }

            .slider {
                background-color: #323232;
            }

            #negative {
                fill: #141414;
            }

        }

    </style>
</head>

<body id="body">
    
    <div id="title">Orientation</div>
    <div id="request" class="horizontal bufferTop" onclick="request()">
        <div class="content" style="color: #147EFB">
            Request sensor permission
            <svg draggable="false" id="click" width="500px" height="500px" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
                <path id="chevron" d="M499.143 250.945 C499.143 254.593 498.471 258.002 497.127 261.17 495.783 264.338 493.766 267.266 491.078 269.955 L262.68 493.169 C257.496 498.353 251.255 500.945 243.959 500.945 238.966 500.945 234.502 499.793 230.566 497.489 226.63 495.185 223.461 492.065 221.061 488.128 218.661 484.192 217.461 479.728 217.461 474.736 217.461 467.631 220.053 461.391 225.237 456.014 L434.915 250.945 225.237 45.876 C220.053 40.5 217.461 34.26 217.461 27.155 217.461 22.163 218.661 17.699 221.061 13.762 223.461 9.826 226.63 6.706 230.566 4.402 234.502 2.097 238.966 0.945 243.959 0.945 251.255 0.945 257.496 3.442 262.68 8.434 L491.078 231.936 C493.766 234.624 495.783 237.552 497.127 240.721 498.471 243.889 499.143 247.297 499.143 250.945 Z" fill="#147efb" fill-opacity="1" stroke="none"/>
            </svg>
        </div>
    </div>
    <div class="horizontal hidden bufferTop">
        <div class="content">
            Alpha [0, 360]
            <div id="alpha"></div>
        </div>
    </div>
    <div class="horizontal hidden">
        <div class="content">
            Beta [-180, 180]
            <div id="beta"></div>
        </div>
    </div>
    <div class="horizontal hidden">
        <div class="content">
            Gamma [-180, 180]
            <div id="gamma"></div>
        </div>
    </div>

    <div class="horizontal hidden bufferTop">
        <div class="content">
            Round numbers
            <label id="switch" class="switch"><input type="checkbox" id="rounded" onclick="precision()"><span class="slider round"></span></label>
        </div>
    </div>
    <div class="horizontal hidden">
        <div class="content">
            Threshold (difference > 2)
            <label id="switch" class="switch"><input type="checkbox" id="threshold" onclick="threshold()"><span class="slider round"></span></label>
        </div>
    </div>

    <div class="description hidden">RECORD RANGE</div>
    <div class="horizontal hidden bufferTop recorder">
        <div class="content">
            <div class="vertical">
                <div class="range"><div class="param">Alpha</div>[<div id="initialA">0</div>,&nbsp;<div id="finalA">0</div>]</div>
                <div class="range"><div class="param">Beta</div>[<div id="initialB">0</div>,&nbsp;<div id="finalB">0</div>]</div>
                <div class="range"><div class="param">Gamma</div>[<div id="initialG">0</div>,&nbsp;<div id="finalG">0</div>]</div>
            </div>
            <svg id="record" onclick="record()" width="60px" height="60px" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
                <path id="border" d="M60 30 C60 13.431 46.569 0 30 0 13.431 0 0 13.431 0 30 0 46.569 13.431 60 30 60 46.569 60 60 46.569 60 30 Z" fill="#b4b4b4" fill-opacity="1" stroke="none"/>
                <path id="negative" d="M57 30 C57 15.088 44.912 3 30 3 15.088 3 3 15.088 3 30 3 44.912 15.088 57 30 57 44.912 57 57 44.912 57 30 Z" fill="#ffffff" fill-opacity="1" stroke="none"/>
                <path id="red" d="M52 30 C52 17.85 42.15 8 30 8 17.85 8 8 17.85 8 30 8 42.15 17.85 52 30 52 42.15 52 52 42.15 52 30 Z" fill="#fd3d30" fill-opacity="1" stroke="none"/>
            </svg>
        </div>
    </div>

    <div class="description hidden">INFOGRAPHICS</div>
    <div class="horizontal hidden bufferTop bufferBottom image">
        <div class="content">
            <img draggable="false" id="illustration" src="https://thorskjold.com/resources/images/illustration.png">
        </div>
    </div>

</body>

<script>

    // illustration preloading
    window.addEventListener('load', function () {
        document.getElementById("illustration").style.display = "block";
    });

    // initialization
    document.addEventListener("touchstart", function(){}, true);
    window.recording = false;
    window.recorded = false;
    window.slow = false;
    window.round = false;

    window.onbeforeunload = function () {
        window.scrollTo(0, 0);
    };

    // recording value range

    function initial(event) {
        document.getElementById("initialA").innerHTML = parseInt(event.alpha);
        document.getElementById("initialB").innerHTML = parseInt(event.beta);
        document.getElementById("initialG").innerHTML = parseInt(event.gamma);
        document.getElementById("finalA").innerHTML = "0";
        document.getElementById("finalB").innerHTML = "0";
        document.getElementById("finalG").innerHTML = "0";
    };

    function final(event) {
        document.getElementById("finalA").innerHTML = parseInt(event.alpha);
        document.getElementById("finalB").innerHTML = parseInt(event.beta);
        document.getElementById("finalG").innerHTML = parseInt(event.gamma);
    };

    // initial range values [X, ...]
    window.addEventListener("deviceorientation", initial);
    document.getElementById("initialA").style.color = "#fd3d30";
    document.getElementById("initialB").style.color = "#fd3d30";
    document.getElementById("initialG").style.color = "#fd3d30";

    function record() {

        if (window.recorded) {

            // initial range values [X, ...]
            window.addEventListener("deviceorientation", initial);
            document.getElementById("initialA").style.color = "#fd3d30";
            document.getElementById("initialB").style.color = "#fd3d30";
            document.getElementById("initialG").style.color = "#fd3d30";

            // reset final values
            document.getElementById("finalA").innerHTML = "0";
            document.getElementById("finalB").innerHTML = "0";
            document.getElementById("finalG").innerHTML = "0";

            // reset record button
            document.getElementById('red').setAttribute('d', 'M52 30 C52 17.85 42.15 8 30 8 17.85 8 8 17.85 8 30 8 42.15 17.85 52 30 52 42.15 52 52 42.15 52 30 Z');
            document.getElementById('red').setAttribute('fill', '#fd3d30');

            // reset record button
            window.recorded = false;

        } else if (window.recording) {

            // change recording button to delete button
            document.getElementById('red').setAttribute('d', 'M19.477 23.688 C19.477 23.688 18.411 22.626 19.467 21.57 20.523 20.513 21.572 19.464 21.572 19.464 21.572 19.464 22.636 18.422 23.682 19.468 24.727 20.514 29.998 25.786 29.998 25.786 L36.314 19.468 C36.314 19.468 37.366 18.414 38.421 19.469 39.475 20.524 40.529 21.578 40.529 21.578 40.529 21.578 41.589 22.623 40.529 23.684 40.238 23.974 34.208 30.006 34.208 30.006 L40.524 36.323 C40.524 36.323 41.583 37.37 40.524 38.429 39.466 39.489 38.423 40.531 38.423 40.531 38.423 40.531 37.372 41.586 36.318 40.531 35.264 39.477 30.002 34.213 30.002 34.213 L23.686 40.531 C23.686 40.531 22.63 41.589 21.568 40.527 20.506 39.465 19.463 38.421 19.463 38.421 19.463 38.421 18.427 37.366 19.475 36.318 20.523 35.269 25.786 30.005 25.786 30.005 L19.477 23.688 Z');
            document.getElementById('red').setAttribute('fill', '#f8d848');

            // reset color of values changed
            document.getElementById("finalA").style.color = "";
            document.getElementById("finalB").style.color = "";
            document.getElementById("finalG").style.color = "";

            // remove final value listener
            window.removeEventListener("deviceorientation", final);

            // change button state to signify that recording can be deleted
            window.recorded = true;

            // deinitialize recording
            window.recording = false;

        } else {
            
            // reset color of values changed
            document.getElementById("initialA").style.color = "";
            document.getElementById("initialB").style.color = "";
            document.getElementById("initialG").style.color = "";

            // change record button
            document.getElementById('red').setAttribute('d', 'M24 19 C21.239 19 19 21.239 19 24 L19 36 C19 38.761 21.239 41 24 41 L36 41 C38.761 41 41 38.761 41 36 L41 24 C41 21.239 38.761 19 36 19 Z');

            // change color of values changed
            document.getElementById("finalA").style.color = "#fd3d30";
            document.getElementById("finalB").style.color = "#fd3d30";
            document.getElementById("finalG").style.color = "#fd3d30";

            // remove initial value listener
            window.removeEventListener("deviceorientation", initial);

            // final range values [..., X]
            window.addEventListener("deviceorientation", final);

            // initialize recording
            window.recording = true;

        };

    };

    // modifiers

    function threshold() {

        if (document.getElementById("threshold").checked) {
            window.slow = true;
        } else {
            window.slow = false;
        };

    };

    function precision() {

        if (document.getElementById("rounded").checked) {
            window.round = true;
        } else {
            window.round = false;
        };
        
    };

    // show content when permission granted

    function granted() {
        var elements = document.getElementsByClassName('hidden');
        for (var i = 0; i < elements.length; i++) {
            elements[i].style.display = "flex";
            /*
            elements[i].classList.add('moveIn');
            */
        };
        /*
        document.getElementById("request").classList.add('moveOut');
        setTimeout(function(){ document.getElementById("request").style.display = "none"; }, 400);
        */
        document.getElementById("request").style.display = "none";
    };

    // event listeners for alpha, beta, gamma

    function assign() {

        window.addEventListener("deviceorientation", function(event) {

            // thresholding numbers
            if (window.slow) {

                if (window.A != null && Math.abs(window.A - event.alpha) > 2) {
                    var A = event.alpha;
                } else {
                    var A = window.A;
                };

                if (window.B != null && Math.abs(window.B - event.beta) > 2) {
                    var B = event.beta;
                } else {
                    var B = window.B;
                };

                if (window.G != null && Math.abs(window.G - event.gamma) > 2) {
                    var G = event.gamma;
                } else {
                    var G = window.G;
                };

            } else {
                var A = event.alpha;
                var B = event.beta;
                var G = event.gamma;
            };

            // rounding numbers
            if (window.round) {
                document.getElementById("alpha").innerHTML = parseInt(A);
                document.getElementById("beta").innerHTML = parseInt(B);
                document.getElementById("gamma").innerHTML = parseInt(G);
            } else {
                document.getElementById("alpha").innerHTML = A;
                document.getElementById("beta").innerHTML = B;
                document.getElementById("gamma").innerHTML = G;
            };

            window.A = A;
            window.B = B;
            window.G = G;

        });

    };

    // sensor permission request

    function request() {


        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
                .then(permissionState => {
                    if (permissionState === 'granted') {
                        assign();
                        granted();
                    };
                })
                .catch(console.error);
        } else {
            assign();
            granted();
        };

    };

</script>

</html>