<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>

        body {
            font-family: -apple-system, Helvetica;
            display: flex;
            flex-direction: column;
            margin: 0;
        }

        .horizontal {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 55px;
            min-height: 55px;
            background: rgb(245, 245, 245);
            border-bottom: 1px solid rgb(220, 220, 220);
        }

        .hidden {
            display: none;
        }
        
        .bufferTop {
            margin-top: 30px;
            border-top: 1px solid rgb(220, 220, 220);
        }

        .bufferBottom {
            margin-bottom: 30px;
            border-bottom: 1px solid rgb(220, 220, 220);
        }

        .image {
            height: 100%;
        }

        .content {
            width: 90%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        #click {
            width: 16px;
            height: 16px;
        }

        #illustration {
            height: 100%;
            width: 100%;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        /* The switch - the box around the slider */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        /* Hide default HTML checkbox */
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* The slider */
        .slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #16c946;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #16c946;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

    </style>
</head>

<body id="body">

    <div class="horizontal bufferTop">
        <div class="content">
            Threshold (difference > 2)
            <label id="switch" class="switch"><input type="checkbox" id="threshold" onclick="threshold()"><span class="slider round"></span></label>
        </div>
    </div>
    <div class="horizontal">
        <div class="content">
            Rounded (integers)
            <label id="switch" class="switch"><input type="checkbox" id="rounded" onclick="precision()"><span class="slider round"></span></label>
        </div>
    </div>
    <div id="request" class="horizontal bufferTop" onclick="request()">
        <div class="content" style="color: #147EFB">
            Start measuring orientation
            <img draggable="false" id="click" src="resources/icons/click.svg">
        </div>
    </div>
    <div class="horizontal hidden bufferTop">
        <div class="content">
            Alpha [0, 360]
            <div id="alpha"></div>
        </div>
    </div>
    <div class="horizontal hidden">
        <div class="content">
            Beta [-180, 180]
            <div id="beta"></div>
        </div>
    </div>
    <div class="horizontal hidden">
        <div class="content">
            Gamma [-180, 180]
            <div id="gamma"></div>
        </div>
    </div>
    <div class="horizontal bufferTop bufferBottom image">
        <div class="content">
            <img draggable="false" id="illustration" src="resources/images/illustration.png">
        </div>
    </div>

</body>

<script>

    // initialization
    window.slow = false;
    window.round = false;

    function threshold() {

        if (document.getElementById("threshold").checked) {
            window.slow = true;
        } else {
            window.slow = false;
        };

    };

    function precision() {

        if (document.getElementById("rounded").checked) {
            window.round = true;
        } else {
            window.round = false;
        };
        
    };

    function assign() {

        document.getElementById("request").style.display = "none";
        if (document.getElementsByClassName('hidden') != null) {
            var elements = document.getElementsByClassName('hidden');
            for (var i = 0; i < elements.length; i++) {
                elements[i].style.display = "flex";
            };
        };

        window.addEventListener("deviceorientation", function(event) {

            // thresholding numbers
            if (window.slow) {

                if (window.A != null && Math.abs(window.A - event.alpha) > 2) {
                    var A = event.alpha;
                } else {
                    var A = window.A;
                };

                if (window.B != null && Math.abs(window.B - event.beta) > 2) {
                    var B = event.beta;
                } else {
                    var B = window.B;
                };

                if (window.G != null && Math.abs(window.G - event.gamma) > 2) {
                    var G = event.gamma;
                } else {
                    var G = window.G;
                };

            } else {
                var A = event.alpha;
                var B = event.beta;
                var G = event.gamma;
            };

            // rounding numbers
            if (window.round) {
                document.getElementById("alpha").innerHTML = parseInt(A);
                document.getElementById("beta").innerHTML = parseInt(B);
                document.getElementById("gamma").innerHTML = parseInt(G);
            } else {
                document.getElementById("alpha").innerHTML = A;
                document.getElementById("beta").innerHTML = B;
                document.getElementById("gamma").innerHTML = G;
            };

            window.A = A;
            window.B = B;
            window.G = G;

        });

        console.log("Listening for orientation.")

    };

    function request() {


        if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
                .then(permissionState => {
                    if (permissionState === 'granted') {
                        assign();
                    };
                })
                .catch(console.error);
        } else {
            assign()
        };

    };

</script>

</html>